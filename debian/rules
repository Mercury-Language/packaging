#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1

# Not comptible with gcc-4.8
export DEB_BUILD_MAINT_OPTIONS = hardening=+all,-fortify,-stackprotectorstrong,-stackprotector
%:
	dh $@ --parallel

# Don't trust autoreconf to do this, it fucks it up, because autotools suck.
.PHONY: autoreconf
autoreconf:
	aclocal -I m4
	autoconf

.PHONY: bootstrap
bootstrap : autoreconf
	DEFAULT_GRADE=hlc.gc.pregen \
	   ./configure --prefix /tmp//mer-boot \
		--enable-libgrades=hlc.gc.pregen
	make install
	make realclean

override_dh_auto_configure: autoreconf bootstrap
	PATH=$$PATH:/tmp/mer-boot/bin dh_auto_configure -- \
		 --enable-libgrades=hlc.gc,hlc.gc.par,reg.gc,reg.par.gc.stseg,reg.gc.decldebug.stseg,reg.gc.trseg,reg.gc.profdeep.stseg,hlc.gc.trseg,reg.gc.memprof.stseg,reg.gc.prof.stseg

override_dh_auto_clean:
	find . -name .gitignore -o -name -cvsignore | xargs rm
	chmod a-x samples extras benchmarks
	if [ -x scripts/mmake ]; then dh_auto_clean; fi

# Don't build dbgsym packages, they don't make sense for Mercury.
override_dh_strip:
	dh_strip --no-automatic-dbgsym

# Testing isn't going to work until we can fix the Mercury build system.
override_dh_auto_test:

